apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "amityvox.fullname" . }}-config
  labels:
    {{- include "amityvox.labels" . | nindent 4 }}
data:
  amityvox.toml: |
    [instance]
    domain = {{ .Values.config.instance.domain | quote }}
    name = {{ .Values.config.instance.name | quote }}
    description = {{ .Values.config.instance.description | quote }}
    federation_mode = {{ .Values.config.instance.federationMode | quote }}

    [database]
    max_connections = {{ .Values.config.database.maxConnections }}

    [auth]
    session_duration = {{ .Values.config.auth.sessionDuration | quote }}
    registration_enabled = {{ .Values.config.auth.registrationEnabled }}
    invite_only = {{ .Values.config.auth.inviteOnly }}
    require_email = {{ .Values.config.auth.requireEmail }}

    [http]
    listen = {{ .Values.config.http.listen | quote }}
    cors_origins = [{{ range $i, $o := .Values.config.http.corsOrigins }}{{ if $i }}, {{ end }}{{ $o | quote }}{{ end }}]

    [websocket]
    listen = {{ .Values.config.websocket.listen | quote }}
    heartbeat_interval = {{ .Values.config.websocket.heartbeatInterval | quote }}
    heartbeat_timeout = {{ .Values.config.websocket.heartbeatTimeout | quote }}

    [logging]
    level = {{ .Values.config.logging.level | quote }}
    format = {{ .Values.config.logging.format | quote }}

    [metrics]
    enabled = {{ .Values.config.metrics.enabled }}
    listen = {{ .Values.config.metrics.listen | quote }}

    [search]
    enabled = {{ .Values.config.search.enabled }}

    [storage]
    type = {{ .Values.config.storage.type | quote }}
    bucket = {{ .Values.config.storage.bucket | quote }}
    region = {{ .Values.config.storage.region | quote }}
    use_ssl = {{ .Values.config.storage.useSSL }}
