<script lang="ts">
	interface Props {
		onselect: (emoji: string) => void;
		onclose: () => void;
	}

	let { onselect, onclose }: Props = $props();
	let search = $state('');
	let activeCategory = $state('smileys');

	const categories: { id: string; label: string; icon: string; emojis: string[] }[] = [
		{ id: 'smileys', label: 'Smileys', icon: 'ðŸ˜Š', emojis: ['ðŸ˜€','ðŸ˜ƒ','ðŸ˜„','ðŸ˜','ðŸ˜†','ðŸ˜…','ðŸ¤£','ðŸ˜‚','ðŸ™‚','ðŸ™ƒ','ðŸ˜‰','ðŸ˜Š','ðŸ˜‡','ðŸ¥°','ðŸ˜','ðŸ¤©','ðŸ˜˜','ðŸ˜—','ðŸ˜š','ðŸ˜™','ðŸ¥²','ðŸ˜‹','ðŸ˜›','ðŸ˜œ','ðŸ¤ª','ðŸ˜','ðŸ¤‘','ðŸ¤—','ðŸ¤­','ðŸ¤«','ðŸ¤”','ðŸ«¡','ðŸ¤','ðŸ¤¨','ðŸ˜','ðŸ˜‘','ðŸ˜¶','ðŸ«¥','ðŸ˜','ðŸ˜’','ðŸ™„','ðŸ˜¬','ðŸ¤¥','ðŸ˜Œ','ðŸ˜”','ðŸ˜ª','ðŸ¤¤','ðŸ˜´','ðŸ˜·','ðŸ¤’','ðŸ¤•','ðŸ¤¢','ðŸ¤®','ðŸ¥µ','ðŸ¥¶','ðŸ¥´','ðŸ˜µ','ðŸ¤¯','ðŸ¤ ','ðŸ¥³','ðŸ¥¸','ðŸ˜Ž','ðŸ¤“','ðŸ§','ðŸ˜•','ðŸ«¤','ðŸ˜Ÿ','ðŸ™','ðŸ˜®','ðŸ˜¯','ðŸ˜²','ðŸ˜³','ðŸ¥º','ðŸ¥¹','ðŸ˜¦','ðŸ˜§','ðŸ˜¨','ðŸ˜°','ðŸ˜¥','ðŸ˜¢','ðŸ˜­','ðŸ˜±','ðŸ˜–','ðŸ˜£','ðŸ˜ž','ðŸ˜“','ðŸ˜©','ðŸ˜«','ðŸ¥±','ðŸ˜¤','ðŸ˜¡','ðŸ˜ ','ðŸ¤¬','ðŸ˜ˆ','ðŸ‘¿','ðŸ’€','â˜ ï¸','ðŸ’©','ðŸ¤¡','ðŸ‘¹','ðŸ‘º','ðŸ‘»','ðŸ‘½','ðŸ‘¾','ðŸ¤–'] },
		{ id: 'gestures', label: 'Gestures', icon: 'ðŸ‘‹', emojis: ['ðŸ‘‹','ðŸ¤š','ðŸ–ï¸','âœ‹','ðŸ––','ðŸ«±','ðŸ«²','ðŸ«³','ðŸ«´','ðŸ‘Œ','ðŸ¤Œ','ðŸ¤','âœŒï¸','ðŸ¤ž','ðŸ«°','ðŸ¤Ÿ','ðŸ¤˜','ðŸ¤™','ðŸ‘ˆ','ðŸ‘‰','ðŸ‘†','ðŸ–•','ðŸ‘‡','â˜ï¸','ðŸ«µ','ðŸ‘','ðŸ‘Ž','âœŠ','ðŸ‘Š','ðŸ¤›','ðŸ¤œ','ðŸ‘','ðŸ™Œ','ðŸ«¶','ðŸ‘','ðŸ¤²','ðŸ¤','ðŸ™','ðŸ’ª','ðŸ¦¾','ðŸ¦¿','ðŸ¦µ','ðŸ¦¶','ðŸ‘‚','ðŸ¦»','ðŸ‘ƒ','ðŸ§ ','ðŸ«€','ðŸ«','ðŸ¦·','ðŸ¦´','ðŸ‘€','ðŸ‘ï¸','ðŸ‘…','ðŸ‘„'] },
		{ id: 'people', label: 'People', icon: 'ðŸ‘¤', emojis: ['ðŸ‘¶','ðŸ‘§','ðŸ§’','ðŸ‘¦','ðŸ‘©','ðŸ§‘','ðŸ‘¨','ðŸ‘©â€ðŸ¦±','ðŸ§‘â€ðŸ¦±','ðŸ‘¨â€ðŸ¦±','ðŸ‘©â€ðŸ¦°','ðŸ§‘â€ðŸ¦°','ðŸ‘¨â€ðŸ¦°','ðŸ‘±â€â™€ï¸','ðŸ‘±','ðŸ‘±â€â™‚ï¸','ðŸ‘©â€ðŸ¦³','ðŸ§‘â€ðŸ¦³','ðŸ‘¨â€ðŸ¦³','ðŸ‘©â€ðŸ¦²','ðŸ§‘â€ðŸ¦²','ðŸ‘¨â€ðŸ¦²','ðŸ§”â€â™€ï¸','ðŸ§”','ðŸ§”â€â™‚ï¸','ðŸ‘µ','ðŸ§“','ðŸ‘´','ðŸ‘²','ðŸ‘³â€â™€ï¸','ðŸ‘³','ðŸ‘³â€â™‚ï¸','ðŸ§•','ðŸ‘®â€â™€ï¸','ðŸ‘®','ðŸ‘®â€â™‚ï¸','ðŸ‘·â€â™€ï¸','ðŸ‘·','ðŸ‘·â€â™‚ï¸','ðŸ’‚â€â™€ï¸','ðŸ’‚','ðŸ’‚â€â™‚ï¸','ðŸ•µï¸â€â™€ï¸','ðŸ•µï¸','ðŸ•µï¸â€â™‚ï¸'] },
		{ id: 'hearts', label: 'Hearts', icon: 'â¤ï¸', emojis: ['â¤ï¸','ðŸ§¡','ðŸ’›','ðŸ’š','ðŸ’™','ðŸ’œ','ðŸ–¤','ðŸ¤','ðŸ¤Ž','ðŸ’”','â¤ï¸â€ðŸ”¥','â¤ï¸â€ðŸ©¹','â£ï¸','ðŸ’•','ðŸ’ž','ðŸ’“','ðŸ’—','ðŸ’–','ðŸ’˜','ðŸ’','ðŸ’Ÿ','â™¥ï¸','ðŸ«¶','ðŸ’‘','ðŸ’','ðŸ’‹'] },
		{ id: 'nature', label: 'Nature', icon: 'ðŸŒ¿', emojis: ['ðŸ¶','ðŸ±','ðŸ­','ðŸ¹','ðŸ°','ðŸ¦Š','ðŸ»','ðŸ¼','ðŸ»â€â„ï¸','ðŸ¨','ðŸ¯','ðŸ¦','ðŸ®','ðŸ·','ðŸ¸','ðŸµ','ðŸ™ˆ','ðŸ™‰','ðŸ™Š','ðŸ’','ðŸ”','ðŸ§','ðŸ¦','ðŸ¤','ðŸ£','ðŸ¥','ðŸ¦†','ðŸ¦…','ðŸ¦‰','ðŸ¦‡','ðŸº','ðŸ—','ðŸ´','ðŸ¦„','ðŸ','ðŸª±','ðŸ›','ðŸ¦‹','ðŸŒ','ðŸž','ðŸœ','ðŸª°','ðŸª²','ðŸª³','ðŸ¦Ÿ','ðŸ¦—','ðŸ•·ï¸','ðŸ•¸ï¸','ðŸ¦‚','ðŸ¢','ðŸ','ðŸ¦Ž','ðŸ¦–','ðŸ¦•','ðŸ™','ðŸ¦‘','ðŸ¦','ðŸ¦ž','ðŸ¦€','ðŸ¡','ðŸ ','ðŸŸ','ðŸ¬','ðŸ³','ðŸ‹','ðŸ¦ˆ','ðŸŠ'] },
		{ id: 'food', label: 'Food', icon: 'ðŸ”', emojis: ['ðŸ','ðŸŽ','ðŸ','ðŸŠ','ðŸ‹','ðŸŒ','ðŸ‰','ðŸ‡','ðŸ“','ðŸ«','ðŸˆ','ðŸ’','ðŸ‘','ðŸ¥­','ðŸ','ðŸ¥¥','ðŸ¥','ðŸ…','ðŸ†','ðŸ¥‘','ðŸ¥¦','ðŸ¥¬','ðŸ¥’','ðŸŒ¶ï¸','ðŸ«‘','ðŸŒ½','ðŸ¥•','ðŸ«’','ðŸ§„','ðŸ§…','ðŸ¥”','ðŸ ','ðŸ«˜','ðŸ¥','ðŸ¥–','ðŸž','ðŸ¥¨','ðŸ¥¯','ðŸ§€','ðŸ¥š','ðŸ³','ðŸ§ˆ','ðŸ¥ž','ðŸ§‡','ðŸ¥“','ðŸ¥©','ðŸ—','ðŸ–','ðŸ¦´','ðŸŒ­','ðŸ”','ðŸŸ','ðŸ•','ðŸ«“','ðŸ¥ª','ðŸ¥™','ðŸ§†','ðŸŒ®','ðŸŒ¯','ðŸ«”','ðŸ¥—','ðŸ¥˜','ðŸ«•','ðŸ¥«','ðŸ','ðŸœ','ðŸ²','ðŸ›','ðŸ£','ðŸ±','ðŸ¥Ÿ','ðŸ¦ª','ðŸ¤','ðŸ™','ðŸš','ðŸ˜','ðŸ¥'] },
		{ id: 'activities', label: 'Activities', icon: 'âš½', emojis: ['âš½','ðŸ€','ðŸˆ','âš¾','ðŸ¥Ž','ðŸŽ¾','ðŸ','ðŸ‰','ðŸ¥','ðŸŽ±','ðŸª€','ðŸ“','ðŸ¸','ðŸ’','ðŸ‘','ðŸ¥','ðŸ','ðŸªƒ','ðŸ¥…','â›³','ðŸª','ðŸ¹','ðŸŽ£','ðŸ¤¿','ðŸ¥Š','ðŸ¥‹','ðŸŽ½','ðŸ›¹','ðŸ›¼','ðŸ›·','â›¸ï¸','ðŸ¥Œ','ðŸŽ¿','â›·ï¸','ðŸ‚','ðŸª‚','ðŸ‹ï¸','ðŸ¤¸','ðŸ¤º','â›¹ï¸','ðŸ¤¾','ðŸŒï¸','ðŸ‡','ðŸ§˜','ðŸ„','ðŸŠ','ðŸ¤½','ðŸš£','ðŸ§—','ðŸšµ','ðŸš´','ðŸ†','ðŸ¥‡','ðŸ¥ˆ','ðŸ¥‰','ðŸ…','ðŸŽ–ï¸','ðŸµï¸','ðŸŽ—ï¸','ðŸŽª','ðŸ¤¹','ðŸŽ­','ðŸŽ¨','ðŸŽ¬','ðŸŽ¤','ðŸŽ§','ðŸŽ¼','ðŸŽ¹','ðŸ¥','ðŸª˜','ðŸŽ·','ðŸŽº','ðŸª—','ðŸŽ¸','ðŸª•','ðŸŽ»'] },
		{ id: 'objects', label: 'Objects', icon: 'ðŸ’¡', emojis: ['âŒš','ðŸ“±','ðŸ“²','ðŸ’»','âŒ¨ï¸','ðŸ–¥ï¸','ðŸ–¨ï¸','ðŸ–±ï¸','ðŸ–²ï¸','ðŸ•¹ï¸','ðŸ—œï¸','ðŸ’½','ðŸ’¾','ðŸ’¿','ðŸ“€','ðŸ“¼','ðŸ“·','ðŸ“¸','ðŸ“¹','ðŸŽ¥','ðŸ“½ï¸','ðŸŽžï¸','ðŸ“ž','â˜Žï¸','ðŸ“Ÿ','ðŸ“ ','ðŸ“º','ðŸ“»','ðŸŽ™ï¸','ðŸŽšï¸','ðŸŽ›ï¸','ðŸ§­','â±ï¸','â²ï¸','â°','ðŸ•°ï¸','âŒ›','â³','ðŸ“¡','ðŸ”‹','ðŸ”Œ','ðŸ’¡','ðŸ”¦','ðŸ•¯ï¸','ðŸª”','ðŸ§¯','ðŸ›¢ï¸','ðŸ’°','ðŸª™','ðŸ’´','ðŸ’µ','ðŸ’¶','ðŸ’·','ðŸªª','ðŸ’³','ðŸ’Ž','âš–ï¸','ðŸªœ','ðŸ§°','ðŸª›','ðŸ”§','ðŸ”¨','âš’ï¸','ðŸ› ï¸','â›ï¸','ðŸªš','ðŸ”©','âš™ï¸','ðŸª¤','ðŸ§±','â›“ï¸','ðŸ§²','ðŸ”«','ðŸ’£','ðŸ§¨','ðŸª“','ðŸ”ª','ðŸ—¡ï¸','âš”ï¸','ðŸ›¡ï¸','ðŸš¬','âš°ï¸','ðŸª¦','âš±ï¸','ðŸº','ðŸ”®','ðŸ“¿','ðŸ§¿','ðŸª¬','ðŸ’ˆ'] },
		{ id: 'symbols', label: 'Symbols', icon: 'âœ¨', emojis: ['âœ¨','ðŸŽ†','ðŸŽ‡','ðŸ§¨','ðŸŽ‰','ðŸŽŠ','ðŸŽˆ','ðŸŽ€','ðŸŽ','ðŸŽ—ï¸','ðŸŽŸï¸','ðŸŽ«','ðŸ”®','ðŸª„','ðŸŽ¯','ðŸŽ²','ðŸŽ°','ðŸ§©','â™ ï¸','â™¥ï¸','â™¦ï¸','â™£ï¸','ðŸƒ','ðŸ€„','ðŸŽ´','ðŸ”‡','ðŸ”ˆ','ðŸ”‰','ðŸ”Š','ðŸ“¢','ðŸ“£','ðŸ“¯','ðŸ””','ðŸ”•','ðŸŽµ','ðŸŽ¶','ðŸ’¹','ðŸ§','ðŸš®','ðŸš°','â™¿','ðŸš¹','ðŸšº','ðŸš»','ðŸš¼','ðŸš¾','ðŸ›‚','ðŸ›ƒ','ðŸ›„','ðŸ›…','âš ï¸','ðŸš¸','â›”','ðŸš«','ðŸš³','ðŸš­','ðŸš¯','ðŸš±','ðŸš·','ðŸ“µ','ðŸ”ž','â˜¢ï¸','â˜£ï¸','âœ…','âŒ','â“','â—','â€¼ï¸','â‰ï¸','ðŸ’¯','ðŸ”…','ðŸ”†'] },
		{ id: 'flags', label: 'Flags', icon: 'ðŸ', emojis: ['ðŸ','ðŸš©','ðŸŽŒ','ðŸ´','ðŸ³ï¸','ðŸ³ï¸â€ðŸŒˆ','ðŸ³ï¸â€âš§ï¸','ðŸ´â€â˜ ï¸','ðŸ‡ºðŸ‡¸','ðŸ‡¬ðŸ‡§','ðŸ‡«ðŸ‡·','ðŸ‡©ðŸ‡ª','ðŸ‡¯ðŸ‡µ','ðŸ‡°ðŸ‡·','ðŸ‡¨ðŸ‡³','ðŸ‡®ðŸ‡³','ðŸ‡§ðŸ‡·','ðŸ‡·ðŸ‡º','ðŸ‡¨ðŸ‡¦','ðŸ‡¦ðŸ‡º','ðŸ‡²ðŸ‡½','ðŸ‡®ðŸ‡¹','ðŸ‡ªðŸ‡¸','ðŸ‡³ðŸ‡±'] }
	];

	const filteredEmojis = $derived.by(() => {
		if (!search.trim()) {
			return categories.find((c) => c.id === activeCategory)?.emojis ?? [];
		}
		// Simple search: return emojis from all categories
		// (since we can't really search emoji by name without a mapping, just show all)
		return categories.flatMap((c) => c.emojis);
	});

	function handleClickOutside(e: MouseEvent) {
		const target = e.target as HTMLElement;
		if (!target.closest('.emoji-picker')) onclose();
	}

	function handleKeydown(e: KeyboardEvent) {
		if (e.key === 'Escape') onclose();
	}
</script>

<svelte:document onclick={handleClickOutside} onkeydown={handleKeydown} />

<div class="emoji-picker absolute bottom-full right-0 z-50 mb-2 w-80 rounded-lg bg-bg-floating shadow-xl">
	<!-- Search -->
	<div class="border-b border-bg-modifier p-2">
		<input
			type="text"
			class="w-full rounded bg-bg-primary px-3 py-1.5 text-sm text-text-primary placeholder:text-text-muted outline-none"
			placeholder="Search emoji..."
			bind:value={search}
		/>
	</div>

	<!-- Category tabs -->
	{#if !search.trim()}
		<div class="flex border-b border-bg-modifier px-1">
			{#each categories as cat (cat.id)}
				<button
					class="flex-1 p-1.5 text-center text-sm transition-colors {activeCategory === cat.id ? 'border-b-2 border-brand-500' : 'hover:bg-bg-modifier'}"
					onclick={() => (activeCategory = cat.id)}
					title={cat.label}
				>
					{cat.icon}
				</button>
			{/each}
		</div>
	{/if}

	<!-- Emoji grid -->
	<div class="grid max-h-56 grid-cols-8 gap-0.5 overflow-y-auto p-2">
		{#each filteredEmojis as emoji (emoji)}
			<button
				class="flex h-8 w-8 items-center justify-center rounded text-xl hover:bg-bg-modifier"
				onclick={() => onselect(emoji)}
			>
				{emoji}
			</button>
		{/each}
	</div>
</div>
